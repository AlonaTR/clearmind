{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Helmet}from'react-helmet';import{useParams,useHistory}from'react-router-dom';import axios from'axios';import'./item.css';import NavBar from'../components/nav-bar';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Item=props=>{const history=useHistory();const{itemid}=useParams();// Retrieve the itemid from the URL\nconst[item,setItem]=useState(null);const[loading,setLoading]=useState(true);const user=localStorage.getItem('user');const getCurrentDate=()=>{const today=new Date();const year=today.getFullYear();let month=today.getMonth()+1;// Month is zero-based\nlet day=today.getDate();// Pad month and day with leading zeros if needed\nif(month<10){month='0'+month;}if(day<10){day='0'+day;}console.log(\"\".concat(year,\"-\").concat(month,\"-\").concat(day));return\"\".concat(year,\"-\").concat(month,\"-\").concat(day);};useEffect(()=>{const fetchItemData=async()=>{try{const response=await axios.get(\"/api/items/\".concat(itemid,\"/\"));// Make sure to add the trailing slash\nsetItem(response.data);setLoading(false);// Set loading to false after data is fetched\n}catch(error){console.error('Error fetching item data:',error);setLoading(false);// Set loading to false even if there's an error\n}};fetchItemData();// Function to handle recording user activity\nconst recordUserActivity=async()=>{try{await axios.post('/api/record-activity/',{user:user,type:item.type,date:getCurrentDate()});}catch(error){console.error('Error recording user activity:',error);}};// Function to check if the video has been watched halfway\nconst handleTimeUpdate=event=>{const videoElement=event.target;const halfWay=videoElement.duration/2;console.log(videoElement.currentTime,halfWay);if(videoElement.currentTime>=halfWay){console.log('POST');videoElement.removeEventListener('timeupdate',handleTimeUpdate);recordUserActivity();// Call the function to record user activity\n}};// Add event listener to the video element\nconst videoElement=document.querySelector('.item-video');if(videoElement){videoElement.addEventListener('timeupdate',handleTimeUpdate);}// Cleanup function to remove the event listener\nreturn()=>{if(videoElement){videoElement.removeEventListener('timeupdate',handleTimeUpdate);}};},[itemid,item]);const handleHome=()=>{history.push('/home');};const handleAllItems=()=>{history.push('/allitems');};return/*#__PURE__*/_jsxs(\"div\",{className:\"item-container\",children:[/*#__PURE__*/_jsxs(Helmet,{children:[/*#__PURE__*/_jsx(\"title\",{children:\"Clear Mind\"}),/*#__PURE__*/_jsx(\"meta\",{property:\"og:title\",content:\"Clear Mind\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-hero\",children:[/*#__PURE__*/_jsx(NavBar,{rootClassName:\"nav-bar-root-class-name\"}),/*#__PURE__*/_jsx(\"div\",{className:\"item-hero1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"item-container1\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"item-hero-heading heading1\",children:\"Clear Mind\"}),/*#__PURE__*/_jsx(\"span\",{className:\"item-hero-sub-heading\",children:\"Discover the Power of Meditation\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"item-details\",children:loading?/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"}):item&&/*#__PURE__*/_jsxs(\"div\",{className:\"item-details1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-container2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"item-text sectionTitle\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"It`s time for yourself\"}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"item-details-heading heading2\",children:item.name}),/*#__PURE__*/_jsx(\"span\",{className:\"item-details-sub-heading\",children:\"Relax, feel your body and enjoy the process\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"video-container\",children:/*#__PURE__*/_jsx(\"iframe\",{className:\"item-video\",src:\"https://www.youtube.com/embed/\".concat(new URL(item.video).searchParams.get(\"v\")),frameBorder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",allowFullScreen:true,onLoad:()=>{const iframe=document.querySelector('.item-video');const contentWindow=iframe.contentWindow;const onHalfway=()=>recordUserActivity();let listener;if(contentWindow){listener=()=>{const currentTime=contentWindow.document.querySelector('video').currentTime;const duration=contentWindow.document.querySelector('video').duration;if(currentTime>=duration/2){onHalfway();iframe.removeEventListener('timeupdate',listener);}};iframe.addEventListener('timeupdate',listener);}}})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"item-footer\",children:/*#__PURE__*/_jsx(\"div\",{className:\"item-container3\"})})]});};export default Item;","map":{"version":3,"names":["React","useEffect","useState","Helmet","useParams","useHistory","axios","NavBar","jsx","_jsx","jsxs","_jsxs","Item","props","history","itemid","item","setItem","loading","setLoading","user","localStorage","getItem","getCurrentDate","today","Date","year","getFullYear","month","getMonth","day","getDate","console","log","concat","fetchItemData","response","get","data","error","recordUserActivity","post","type","date","handleTimeUpdate","event","videoElement","target","halfWay","duration","currentTime","removeEventListener","document","querySelector","addEventListener","handleHome","push","handleAllItems","className","children","property","content","rootClassName","name","src","URL","video","searchParams","frameBorder","allow","allowFullScreen","onLoad","iframe","contentWindow","onHalfway","listener"],"sources":["D:/polska/clearmind/meditation_project/reactapp/src/views/item.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { Helmet } from 'react-helmet'\r\nimport { useParams, useHistory } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport './item.css'\r\nimport NavBar from '../components/nav-bar'\r\n\r\n\r\nconst Item = (props) => {\r\n  const history = useHistory();\r\n  const { itemid } = useParams(); // Retrieve the itemid from the URL\r\n  const [item, setItem] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const user = localStorage.getItem('user');\r\n\r\n\r\n  const getCurrentDate=() => {\r\n    const today = new Date();\r\n    const year = today.getFullYear();\r\n    let month = today.getMonth() + 1; // Month is zero-based\r\n    let day = today.getDate();\r\n\r\n    // Pad month and day with leading zeros if needed\r\n    if (month < 10) {\r\n      month = '0' + month;\r\n    }\r\n    if (day < 10) {\r\n      day = '0' + day;\r\n    }\r\n    console.log(`${year}-${month}-${day}`)\r\n    return `${year}-${month}-${day}`;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchItemData = async () => {\r\n      try {\r\n        const response = await axios.get(`/api/items/${itemid}/`); // Make sure to add the trailing slash\r\n        setItem(response.data);\r\n        setLoading(false); // Set loading to false after data is fetched\r\n      } catch (error) {\r\n        console.error('Error fetching item data:', error);\r\n        setLoading(false); // Set loading to false even if there's an error\r\n      }\r\n    };\r\n\r\n    fetchItemData();\r\n\r\n    // Function to handle recording user activity\r\n    const recordUserActivity = async () => {\r\n      try {\r\n        await axios.post('/api/record-activity/', {\r\n          user: user,\r\n          type: item.type,\r\n          date: getCurrentDate()\r\n        });\r\n      } catch (error) {\r\n        console.error('Error recording user activity:', error);\r\n      }\r\n      \r\n    };\r\n\r\n    // Function to check if the video has been watched halfway\r\n    const handleTimeUpdate = (event) => {\r\n      const videoElement = event.target;\r\n      const halfWay = videoElement.duration / 2;\r\n      console.log(videoElement.currentTime, halfWay)\r\n      if (videoElement.currentTime >= halfWay ) {\r\n        console.log('POST')\r\n        videoElement.removeEventListener('timeupdate', handleTimeUpdate);\r\n        recordUserActivity(); // Call the function to record user activity\r\n      }\r\n    };\r\n\r\n    // Add event listener to the video element\r\n    const videoElement = document.querySelector('.item-video');\r\n    if (videoElement) {\r\n      videoElement.addEventListener('timeupdate', handleTimeUpdate);\r\n    }\r\n\r\n    // Cleanup function to remove the event listener\r\n    return () => {\r\n      if (videoElement) {\r\n        videoElement.removeEventListener('timeupdate', handleTimeUpdate);\r\n      }\r\n    };\r\n\r\n  }, [itemid, item]);\r\n\r\n\r\n  const handleHome = () => {\r\n    history.push('/home'); \r\n  };\r\n\r\n  const handleAllItems = () => {\r\n    history.push('/allitems'); \r\n  };\r\n\r\n  return (\r\n    <div className=\"item-container\">\r\n      <Helmet>\r\n        <title>Clear Mind</title>\r\n        <meta property=\"og:title\" content=\"Clear Mind\" />\r\n      </Helmet>\r\n      <div className=\"item-hero\">\r\n        <NavBar rootClassName=\"nav-bar-root-class-name\"></NavBar>\r\n        <div className=\"item-hero1\">\r\n          <div className=\"item-container1\">\r\n            <h1 className=\"item-hero-heading heading1\">Clear Mind</h1>\r\n            <span className=\"item-hero-sub-heading\">\r\n              Discover the Power of Meditation\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"item-details\">\r\n        {loading ? (\r\n          <div>Loading...</div> \r\n        ) : (\r\n          item && ( \r\n            <div className=\"item-details1\">\r\n              <div className=\"item-container2\">\r\n                <span className=\"item-text sectionTitle\">\r\n                <span>It`s time for yourself</span>\r\n                <br></br>\r\n                </span>\r\n                <h2 className=\"item-details-heading heading2\">{item.name}</h2>\r\n                <span className=\"item-details-sub-heading\">\r\n                  Relax, feel your body and enjoy the process\r\n                </span>\r\n              </div>\r\n              <div className=\"video-container\">\r\n                <iframe\r\n                  className=\"item-video\"\r\n                  src={`https://www.youtube.com/embed/${new URL(item.video).searchParams.get(\"v\")}`}\r\n                  frameBorder=\"0\"\r\n                  allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n                  allowFullScreen\r\n                  onLoad={() => {\r\n                    const iframe = document.querySelector('.item-video');\r\n                    const contentWindow = iframe.contentWindow;\r\n                    const onHalfway = () => recordUserActivity();\r\n                    let listener;\r\n\r\n                    if (contentWindow) {\r\n                      listener = () => {\r\n                        const currentTime = contentWindow.document.querySelector('video').currentTime;\r\n                        const duration = contentWindow.document.querySelector('video').duration;\r\n                        if (currentTime >= duration / 2) {\r\n                          onHalfway();\r\n                          iframe.removeEventListener('timeupdate', listener);\r\n                        }\r\n                      };\r\n\r\n                      iframe.addEventListener('timeupdate', listener);\r\n                    }\r\n                  }}\r\n                ></iframe>\r\n              </div>\r\n            </div>\r\n          )\r\n        )}\r\n      </div>\r\n      <div className=\"item-footer\">\r\n        <div className=\"item-container3\"></div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Item\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}